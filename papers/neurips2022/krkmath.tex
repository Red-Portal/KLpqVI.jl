
\usepackage{amsmath,amssymb,amsthm}
\usepackage{mathtools}

% Math and main text font nonsense
\ifxetex
  \usepackage{fontspec}
  \usepackage{microtype}
  \usepackage{unicode-math}
  \setmathfont{STIXTwoMath-Regular.otf}
  \setmainfont[
    BoldFont={STIXTwoText-Bold.otf}, 
    ItalicFont={STIXTwoText-Italic.otf},
    BoldItalicFont={STIXTwoText-BoldItalic.otf}]{STIXTwoText-Regular.otf}
  %\setmainfont{Times New Roman}
  %\setmathfont{Erewhon-Math.otf}

  %\setmainfont{TeX Gyre Schola}[Scale=0.90] % Text
  % Math: mix of Erewhon and Schola
  %\setmathfont{Erewhon-Math.otf}
  % \setmathfont{TeX Gyre Schola Math}[Scale=0.93,
  %%     range={up/{latin,Latin,num}, it/{latin,Latin,num},
  %%            bfup/{latin,Latin,num}, bfit{latin,Latin,num}}]

  \newcommand{\mathmat}[1]{\symbfup{#1}}
  \newcommand{\mathvec}[1]{\symbfup{#1}}
  \newcommand{\mathvecgreek}[1]{\symbfup{#1}}
  \newcommand{\mathmatgreek}[1]{\symbfup{#1}}

  \newcommand{\mathrv}[1]{\mathsf{#1}}
  \newcommand{\mathrvvec}[1]{\mathbfsf{#1}}
  \newcommand{\mathrvgreek}[1]{\mathsf{#1}}
  \newcommand{\mathrvvecgreek}[1]{\mathbfsf{#1}}
\else
  \usepackage[T1]{fontenc}
  \usepackage[notext,lcgreekalpha]{stix2}
  \usepackage{newtxtext}
  \usepackage{textcomp}

  \newcommand{\mathmat}[1]{\mathbf{#1}}
  \newcommand{\mathvec}[1]{\mathbf{#1}}
  \newcommand{\mathvecgreek}[1]{\mathbf{#1}}
  \newcommand{\mathmatgreek}[1]{\mathbf{#1}}

  \newcommand{\mathrv}[1]{\mathsf{#1}}
  \newcommand{\mathrvvec}[1]{\mathbfsf{#1}}
  \newcommand{\mathrvgreek}[1]{\mathsf{#1}}
  \newcommand{\mathrvvecgreek}[1]{\mathbfsf{#1}}
\fi

\usepackage{booktabs,threeparttable,arydshln}
\usepackage{multirow}
\usepackage{nicematrix}

\usepackage{dsfont}
\usepackage[algo2e, ruled]{algorithm2e}

\usepackage{pgfplots}
\pgfkeys{/pgfplots/tuftelike/.style={
  semithick,
  tick style={major tick length=4pt,semithick,black},
  separate axis lines,
  axis x line*=bottom,
  axis x line shift=2pt,
  xlabel shift=-2pt,
  axis y line*=left,
  axis y line shift=2pt,
  ylabel shift=-2pt}}
  
\usepackage{proof-at-the-end}
\declaretheoremstyle[
    spaceabove=0\topsep,
    spacebelow=0\topsep,
    name={Proposition},
]{propsty}
\declaretheorem[style=propsty]{proposition}

\declaretheoremstyle[
    spaceabove=0\topsep,
    spacebelow=0\topsep,
    name={Theorem},
]{thmsty}
\declaretheorem[style=thmsty]{theorem}

\newtheorem{remark}{\textbf{Remark}}
\newtheorem{lemma}{\textbf{Lemma}}
\newtheorem{assumption}{\textbf{Assumption}}
\newtheorem{condition}{\textbf{Condition}}
%\newtheorem{theorem}{\textbf{Theorem}}
%\newtheorem{proposition}{\textbf{Proposition}}
\newtheorem{definition}{\textbf{Definition}}

\usepackage{mdframed}
\newmdtheoremenv{framedtheorem}{\textbf{Theorem}}
\newmdtheoremenv{framedproposition}{\textbf{Proposition}}
\newmdtheoremenv{framedlemma}{\textbf{Lemma}}

\usepackage{url}
\usepackage{hyperref}
\usepackage[noabbrev, capitalise, nameinlink]{cleveref}

\crefname{assumption}{Assumption}{Assumption}
\crefname{condition}{Condition}{Condition}

\crefname{framedtheorem}{Theorem}{Theorems}
\crefname{framedproposition}{Proposition}{Propositions}
\crefname{framedlemma}{Lemma}{Lemmas}

\makeatletter
\def\adl@drawiv#1#2#3{%
        \hskip.5\tabcolsep
        \xleaders#3{#2.5\@tempdimb #1{1}#2.5\@tempdimb}%
                #2\z@ plus1fil minus1fil\relax
        \hskip.5\tabcolsep}
\newcommand{\cdashlinelr}[1]{%
  \noalign{\vskip\aboverulesep
           \global\let\@dashdrawstore\adl@draw
           \global\let\adl@draw\adl@drawiv}
  \cdashline{#1}
  \noalign{\global\let\adl@draw\@dashdrawstore
           \vskip\belowrulesep}}
\makeatother

\pgfkeys{/prAtEnd/global custom defaults/.style={
    %proof at the end,
    end,
    %normal,
    restate,
    %% text link={\textit{Proof.} See page~\pageref{proof:prAtEnd\pratendcountercurrent} of the \textit{supplementary material}.},
    %text link={\textit{Proof.} The proof is in the \textit{supplementary material}.
    text proof={Proof},
    text link={\textit{Proof.} See the \hyperref[proof:prAtEnd\pratendcountercurrent]{\textit{full proof}} in page~\pageref{proof:prAtEnd\pratendcountercurrent}.}
  }
}

\def\code#1{\texttt{#1}}
\DeclareMathOperator*{\minimize}{minimize}
\DeclareMathOperator*{\maximize}{maximize}
\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min} 

\newcommand*\xbar[1]{%
  \hbox{%
    \vbox{%
      \hrule height 0.6pt % The actual bar
      \kern0.33ex%         % Distance between bar and symbol
      \hbox{%
        \kern-0.1em%      % Shortening on the left side
        \ensuremath{#1}%
        \kern-0.1em%      % Shortening on the right side
      }%
    }%
  }%
} 

\newcommand{\E}[1]{\mathbb{E}\left[\,#1\,\right]}
\newcommand{\Esub}[2]{\mathbb{E}_{#1}\left[\,#2\,\right]}
\newcommand{\V}[1]{\mathbb{V}\left[\,#1\,\right]}
\newcommand{\Vsub}[2]{\mathbb{V}_{#1}\left[\,#2\,\right]}
\newcommand{\Cov}[1]{\mathrm{Cov}\left(\,#1\,\right)}
\newcommand{\Covsub}[2]{\mathrm{Cov}_{#1}\left(\,#2\,\right)}
\newcommand{\Corr}[1]{\mathrm{Corr}\left(\,#1\,\right)}

\newcommand{\Df}[2]{d_{f}(#1\parallel#2)}
\newcommand{\DKL}[2]{d_{\mathrm{KL}}(#1\parallel#2)}
\newcommand{\DChi}[2]{d_{\chi^2}(#1\parallel#2)}
\newcommand{\norm}[1]{{\left\lVert\,#1\,\right\rVert}}
\newcommand{\abs}[1]{{\left|\,#1\,\right|}}
\newcommand{\DTV}[2]{{d_{\mathrm{TV}}\left(#1, #2\right)}}

\newcommand{\vX}{\mathrv{X}}
\newcommand{\vY}{\mathrv{Y}}
\newcommand{\vZ}{\mathrv{Z}}

\newcommand{\va}{\mathvec{a}}
\newcommand{\vb}{\mathvec{b}}
\newcommand{\vc}{\mathvec{c}}
\newcommand{\vd}{\mathvec{d}}
\newcommand{\ve}{\mathvec{e}}
\newcommand{\vf}{\mathvec{f}}
\newcommand{\vg}{\mathvec{g}}
\newcommand{\vh}{\mathvec{h}}
\newcommand{\vi}{\mathvec{i}}
\newcommand{\vj}{\mathvec{j}}
\newcommand{\vk}{\mathvec{k}}
\newcommand{\vl}{\mathvec{l}}
\newcommand{\vm}{\mathvec{m}}
\newcommand{\vn}{\mathvec{n}}
\newcommand{\vo}{\mathvec{o}}
\newcommand{\vp}{\mathvec{p}}
\newcommand{\vq}{\mathvec{q}}
\newcommand{\vr}{\mathvec{r}}
\newcommand{\vs}{\mathvec{s}}
\newcommand{\vt}{\mathvec{t}}
\newcommand{\vu}{\mathvec{u}}
\newcommand{\vv}{\mathvec{v}}
\newcommand{\vw}{\mathvec{w}}
\newcommand{\vx}{\mathvec{x}}
\newcommand{\vy}{\mathvec{y}}
\newcommand{\vz}{\mathvec{z}}
\newcommand{\valpha}{\mathvecgreek{\alpha}}
\newcommand{\veta}{\mathvecgreek{\eta}}
\newcommand{\vmu}{\mathvecgreek{\mu}}
\newcommand{\vtheta}{\mathvecgreek{\theta}}
\newcommand{\vlambda}{\mathvecgreek{\lambda}}
\newcommand{\vxi}{\mathvecgreek{\xi}}

\newcommand{\rva}{\mathrv{a}}
\newcommand{\rvb}{\mathrv{b}}
\newcommand{\rvc}{\mathrv{c}}
\newcommand{\rvd}{\mathrv{d}}
\newcommand{\rve}{\mathrv{e}}
\newcommand{\rvf}{\mathrv{f}}
\newcommand{\rvg}{\mathrv{g}}
\newcommand{\rvh}{\mathrv{h}}
\newcommand{\rvi}{\mathrv{i}}
\newcommand{\rvj}{\mathrv{j}}
\newcommand{\rvk}{\mathrv{k}}
\newcommand{\rvl}{\mathrv{l}}
\newcommand{\rvm}{\mathrv{m}}
\newcommand{\rvn}{\mathrv{n}}
\newcommand{\rvo}{\mathrv{o}}
\newcommand{\rvp}{\mathrv{p}}
\newcommand{\rvq}{\mathrv{q}}
\newcommand{\rvr}{\mathrv{r}}
\newcommand{\rvs}{\mathrv{s}}
\newcommand{\rvt}{\mathrv{t}}
\newcommand{\rvu}{\mathrv{u}}
\newcommand{\rvv}{\mathrv{v}}
\newcommand{\rvw}{\mathrv{w}}
\newcommand{\rvx}{\mathrv{x}}
\newcommand{\rvy}{\mathrv{y}}
\newcommand{\rvz}{\mathrv{z}}
\newcommand{\rvA}{\mathrv{A}}
\newcommand{\rvB}{\mathrv{B}}
\newcommand{\rvC}{\mathrv{C}}
\newcommand{\rvD}{\mathrv{D}}
\newcommand{\rvE}{\mathrv{E}}
\newcommand{\rvF}{\mathrv{F}}
\newcommand{\rvG}{\mathrv{G}}
\newcommand{\rvH}{\mathrv{H}}
\newcommand{\rvI}{\mathrv{I}}
\newcommand{\rvJ}{\mathrv{J}}
\newcommand{\rvK}{\mathrv{K}}
\newcommand{\rvL}{\mathrv{L}}
\newcommand{\rvM}{\mathrv{M}}
\newcommand{\rvN}{\mathrv{N}}
\newcommand{\rvO}{\mathrv{O}}
\newcommand{\rvP}{\mathrv{P}}
\newcommand{\rvQ}{\mathrv{Q}}
\newcommand{\rvR}{\mathrv{R}}
\newcommand{\rvS}{\mathrv{S}}
\newcommand{\rvT}{\mathrv{T}}
\newcommand{\rvU}{\mathrv{U}}
\newcommand{\rvV}{\mathrv{V}}
\newcommand{\rvW}{\mathrv{W}}
\newcommand{\rvX}{\mathrv{X}}
\newcommand{\rvY}{\mathrv{Y}}
\newcommand{\rvZ}{\mathrv{Z}}
\newcommand{\rveta}{\mathrvgreek{\eta}}
\newcommand{\rvlambda}{\mathrvgreek{\lambda}}

\newcommand{\rvva}{\mathrvvec{a}}
\newcommand{\rvvb}{\mathrvvec{b}}
\newcommand{\rvvc}{\mathrvvec{c}}
\newcommand{\rvvd}{\mathrvvec{d}}
\newcommand{\rvve}{\mathrvvec{e}}
\newcommand{\rvvf}{\mathrvvec{f}}
\newcommand{\rvvg}{\mathrvvec{g}}
\newcommand{\rvvh}{\mathrvvec{h}}
\newcommand{\rvvi}{\mathrvvec{i}}
\newcommand{\rvvj}{\mathrvvec{j}}
\newcommand{\rvvk}{\mathrvvec{k}}
\newcommand{\rvvl}{\mathrvvec{l}}
\newcommand{\rvvm}{\mathrvvec{m}}
\newcommand{\rvvn}{\mathrvvec{n}}
\newcommand{\rvvo}{\mathrvvec{o}}
\newcommand{\rvvp}{\mathrvvec{p}}
\newcommand{\rvvq}{\mathrvvec{q}}
\newcommand{\rvvr}{\mathrvvec{r}}
\newcommand{\rvvs}{\mathrvvec{s}}
\newcommand{\rvvt}{\mathrvvec{t}}
\newcommand{\rvvu}{\mathrvvec{u}}
\newcommand{\rvvv}{\mathrvvec{v}}
\newcommand{\rvvw}{\mathrvvec{w}}
\newcommand{\rvvx}{\mathrvvec{x}}
\newcommand{\rvvy}{\mathrvvec{y}}
\newcommand{\rvvz}{\mathrvvec{z}}
\newcommand{\rvvlambda}{\mathrvvecgreek{\lambda}}
\newcommand{\rvveta}{\mathrvvecgreek{\eta}}

\newcommand{\mA}{\mathmat{A}}
\newcommand{\mB}{\mathmat{B}}
\newcommand{\mC}{\mathmat{C}}
\newcommand{\mD}{\mathmat{D}}
\newcommand{\mE}{\mathmat{E}}
\newcommand{\mF}{\mathmat{F}}
\newcommand{\mG}{\mathmat{G}}
\newcommand{\mH}{\mathmat{H}}
\newcommand{\mI}{\mathmat{I}}
\newcommand{\mJ}{\mathmat{J}}
\newcommand{\mK}{\mathmat{K}}
\newcommand{\mL}{\mathmat{L}}
\newcommand{\mM}{\mathmat{M}}
\newcommand{\mN}{\mathmat{N}}
\newcommand{\mO}{\mathmat{O}}
\newcommand{\mP}{\mathmat{P}}
\newcommand{\mQ}{\mathmat{Q}}
\newcommand{\mR}{\mathmat{R}}
\newcommand{\mS}{\mathmat{S}}
\newcommand{\mT}{\mathmat{T}}
\newcommand{\mU}{\mathmat{U}}
\newcommand{\mV}{\mathmat{V}}
\newcommand{\mW}{\mathmat{W}}
\newcommand{\mX}{\mathmat{X}}
\newcommand{\mY}{\mathmat{Y}}
\newcommand{\mZ}{\mathmat{Z}}
\newcommand{\mSigma}{\mathmatgreek{\Sigma}}

\newcommand{\iprod}[2]{\left\langle #1, #2 \right\rangle}
\newcommand{\ind}[1]{\mathds{1}_{#1}}
